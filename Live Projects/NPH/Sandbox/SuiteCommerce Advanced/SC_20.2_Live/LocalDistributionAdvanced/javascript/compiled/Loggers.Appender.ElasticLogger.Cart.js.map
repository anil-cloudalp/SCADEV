{"version":3,"sources":["Loggers.Appender.ElasticLogger.Cart.ts"],"names":[],"mappings":"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","file":"Loggers.Appender.ElasticLogger.Cart.js","sourcesContent":["/*\n\tÂ© 2020 NetSuite Inc.\n\tUser may not copy, modify, distribute, or re-bundle or otherwise make available this code;\n\tprovided, however, if you are an authorized user with a NetSuite account or log-in, you\n\tmay use this code subject to the terms that govern your access and use.\n*/\n\n/// <amd-module name=\"Loggers.Appender.ElasticLogger.Cart\"/>\n\nimport * as _ from 'underscore';\nimport { Loggers } from './Loggers';\n\nimport LiveOrderModel = require('../../LiveOrder/JavaScript/LiveOrder.Model');\n\nexport = {\n    mountToApp() {\n        const logger = Loggers.getLogger();\n        const liveOrder = LiveOrderModel.getInstance();\n        let freeItemsBeforeAddLine = [];\n        let freeItemsBeforeRemoveLine = [];\n        let freeItemsBeforeAddPromotion = [];\n        let freeItemsBeforeRemovePromotion = [];\n        let submitLines = [];\n\n        liveOrder.on('before:LiveOrder.addLines', () => {\n            const lines = liveOrder.get('lines');\n            freeItemsBeforeAddLine = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    freeItemsBeforeAddLine.push(line.get('item').get('internalid'));\n                }\n            });\n        });\n\n        liveOrder.on('after:LiveOrder.addLines', () => {\n            const lines = liveOrder.get('lines');\n            const obj = {\n                componentArea: 'ADDED_TO_CART',\n                freeGiftQty: 0\n            };\n\n            const newInternalids = [];\n\n            lines.forEach((line: any) => {\n                const newLine =\n                    _.indexOf(freeItemsBeforeAddLine, line.get('item').get('internalid')) === -1;\n\n                if (line.get('free_gift') && newLine && line.get('item')) {\n                    newInternalids.push(line.get('item').get('internalid'));\n                }\n            });\n\n            if (newInternalids.length) {\n                obj.freeGiftQty = newInternalids.length;\n                // Because afterAddLine is triggered many times consecutively,\n                // we must refresh the old free items.\n                freeItemsBeforeAddLine = [...freeItemsBeforeAddLine, ...newInternalids];\n                logger.info(obj);\n            }\n        });\n\n        liveOrder.on('before:LiveOrder.addPromotion', () => {\n            const lines = liveOrder.get('lines');\n            freeItemsBeforeAddPromotion = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    freeItemsBeforeAddPromotion.push(line.get('item').get('internalid'));\n                }\n            });\n        });\n\n        liveOrder.on('after:LiveOrder.addPromotion', () => {\n            const lines = liveOrder.get('lines');\n            const obj = {\n                componentArea: 'ADDED_TO_CART',\n                freeGiftQty: 0\n            };\n\n            const newInternalids = [];\n\n            lines.forEach((line: any) => {\n                const newLine =\n                    _.indexOf(freeItemsBeforeAddPromotion, line.get('item').get('internalid')) ===\n                    -1;\n\n                if (line.get('free_gift') && newLine && line.get('item')) {\n                    newInternalids.push(line.get('item').get('internalid'));\n                }\n            });\n\n            if (newInternalids.length) {\n                obj.freeGiftQty = newInternalids.length;\n                freeItemsBeforeAddPromotion = [...freeItemsBeforeAddPromotion, ...newInternalids];\n                logger.info(obj);\n            }\n        });\n\n        liveOrder.on('before:LiveOrder.removePromotion', () => {\n            const lines = liveOrder.get('lines');\n            freeItemsBeforeRemovePromotion = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    freeItemsBeforeRemovePromotion.push(line.get('item').get('internalid'));\n                }\n            });\n        });\n\n        liveOrder.on('after:LiveOrder.removePromotion', () => {\n            const lines = liveOrder.get('lines');\n            const obj = {\n                componentArea: 'REMOVED_FROM_CART',\n                freeGiftQty: 0\n            };\n\n            const internalids = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    internalids.push(line.get('item').get('internalid'));\n                }\n            });\n\n            const removedInternalids = _.difference(freeItemsBeforeRemovePromotion, internalids);\n\n            if (removedInternalids.length) {\n                obj.freeGiftQty = removedInternalids.length;\n                freeItemsBeforeRemovePromotion = internalids;\n                logger.info(obj);\n            }\n        });\n\n        liveOrder.on('before:LiveOrder.removeLine', () => {\n            const lines = liveOrder.get('lines');\n            freeItemsBeforeRemoveLine = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    freeItemsBeforeRemoveLine.push(line.get('item').get('internalid'));\n                }\n            });\n        });\n\n        liveOrder.on('after:LiveOrder.removeLine', () => {\n            const lines = liveOrder.get('lines');\n            const obj = {\n                componentArea: 'REMOVED_FROM_CART',\n                freeGiftQty: 0\n            };\n\n            const internalids = [];\n\n            lines.forEach((line: any) => {\n                if (line.get('free_gift') && line.get('item')) {\n                    internalids.push(line.get('item').get('internalid'));\n                }\n            });\n\n            const removedInternalids = _.difference(freeItemsBeforeRemoveLine, internalids);\n\n            if (removedInternalids.length) {\n                obj.freeGiftQty = removedInternalids.length;\n                freeItemsBeforeRemoveLine = internalids;\n                logger.info(obj);\n            }\n        });\n\n        liveOrder.on('before:LiveOrder.submit', () => {\n            submitLines = liveOrder.get('lines');\n        });\n\n        liveOrder.on('after:LiveOrder.submit', () => {\n            const obj = {\n                componentArea: 'PLACED_ORDER',\n                freeGiftQty: 0\n            };\n\n            submitLines.forEach((line: any) => {\n                if (line.get('free_gift')) {\n                    obj.freeGiftQty++;\n                }\n            });\n\n            logger.info(obj);\n        });\n    }\n};\n"]}