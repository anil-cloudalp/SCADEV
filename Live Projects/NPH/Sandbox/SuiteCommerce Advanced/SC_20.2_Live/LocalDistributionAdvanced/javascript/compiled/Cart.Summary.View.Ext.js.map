{"version":3,"sources":["Cart.Summary.View.Ext.ts"],"names":[],"mappings":"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","file":"Cart.Summary.View.Ext.js","sourcesContent":["/// <amd-module name=\"Cart.Summary.View.Ext\"/>\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\n\nimport existingView = require('../../../Commons/Cart/JavaScript/Cart.Summary.View');\nimport { Configuration } from '../../../Commons/Utilities/JavaScript/Configuration';\nimport { ProfileModel } from '../../../Commons/Profile/JavaScript/Profile.Model';\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\n_.extend(existingView.prototype, {\n\t\n\t // @method getContext\n    // @return {Cart.Summary.View.Context}\n    getContext: function getContext() {\n        let continueURL =\n            Configuration.get('siteSettings.sitetype') === 'ADVANCED'\n                ? Configuration.defaultSearchUrl\n                : '';\n        let is_wsdk = false;\n        const summary = this.model.get('summary');\n        var items_count = _.reduce(\n            this.model.get('lines').pluck('quantity'),\n            function(memo, quantity: any) {\n                return memo + (parseFloat(quantity) || 1);\n            },\n            0\n        );\n        const shipping_address =\n            this.model.get('addresses').get(this.model.get('shipaddress')) || new Backbone.Model();\n        const default_country =\n            shipping_address.get('country') || Configuration.get('siteSettings.defaultshipcountry');\n        const shipping_zip_code = shipping_address.get('zip');\n        const promocodes = this.model.get('promocodes') || [];\n        const promocodes_applied = _.filter(promocodes, function(promo: any) {\n            return (\n                (promo.isautoapplied == true && promo.isvalid == true) ||\n                promo.isautoapplied == false\n            );\n        });\n        const gift_certificates =\n            this.model.get('paymentmethods').where({ type: 'giftcertificate' }) || [];\n        const is_single_country = _.size(Configuration.get('siteSettings.countries', [])) === 1;\n        let is_zipcode_require;\n        let selected_country;\n        let countries_list;\n        let is_estimated_shipping_valid;\n        let show_estimation_form = true;\n        const countries = _.clone(Configuration.get('siteSettings.countries'));\n\n        // Determine if the Zip Code is required and just leave selected the current address\n        if (countries && default_country && countries[default_country]) {\n            selected_country = _.findWhere(countries, { selected: true });\n            if (selected_country) {\n                selected_country.selected = false;\n            }\n\n            countries[default_country].selected = true;\n\t\t\t\n\t\t\tis_zipcode_require = (default_country == 'US' || default_country == 'CA');\n\t\t\t\t\n            //is_zipcode_require = countries[default_country].isziprequired !== 'F';\n            selected_country = countries[default_country];\n            countries_list = _.toArray(countries);\n        } else {\n            selected_country = _.findWhere(countries, { selected: true });\n            countries_list = _.toArray(countries);\n\n            if (!selected_country) {\n                selected_country = _.first(countries_list);\n            }\n\t\t\tis_zipcode_require = (selected_country.code == 'US' || selected_country.code == 'CA');\n\t\t\t\t\n            //is_zipcode_require = selected_country.isziprequired !== 'F';\n        }\n\n        // Determine if the current address is valid (complete)\n        if (_.isString(shipping_address.id) && shipping_address.id !== '-------null') {\n            is_estimated_shipping_valid = is_zipcode_require\n                ? !!shipping_zip_code\n                : !!shipping_address.get('country');\n        } else {\n            is_estimated_shipping_valid = false;\n        }\n\n        // Check if WSDK is configured\n        if (\n            Configuration.get('siteSettings.iswsdk', false) &&\n            Configuration.get('siteSettings.wsdkcancelcarturl')\n        ) {\n            continueURL = Configuration.get('siteSettings.wsdkcancelcarturl');\n            is_wsdk = true;\n        }\n\n        // Calculate if the estimation form should be rendered or not\n        if (\n            Configuration.get('siteSettings.showshippingestimator') === 'F' ||\n            (is_estimated_shipping_valid && is_zipcode_require)\n        ) {\n            show_estimation_form = false;\n        }\n\t\t\n\t\t_.each(this.model.get('lines').models,function(line:any){\n\t\t\n\t\t\t if(line.get('item').get('custitem_appf_is_imprint_item') == true)\n\t\t\t {\n\n\t\t\t\t items_count = items_count - line.get('quantity');\n\n\t\t\t }\n\t\t});\n\t\t\n\t\tvar digitalItems = this.model.get('lines').filter(function(line:any){\n\t\t\t\n\t\t\tvar item = line.getItem();\n\t\t\treturn (item.get('custitem_appf_is_downloadable_item') || item.get('custitem10'));\n\n\t\t});\n\t\t\n\t\tconst profileModel = ProfileModel.getInstance();\n        // @class Cart.Summary.View.Context\n        return {\n            // @property {LiveOrder.Model} model\n            model: this.model,\n            // @property {Boolean} isWSDK\n            isWSDK: is_wsdk,\n            // @property {String} continueURL\n            continueURL: continueURL,\n            // @property {Boolean} showActions\n            showActions: true,\n            // @property {Boolean} showLabelsAsEstimated\n            showLabelsAsEstimated: true,\n            // @property {Object} summary\n            summary: summary,\n            // @property {Number} itemCount\n            itemCount: items_count,\n            // @property {Boolean} isSingleItem\n            isSingleItem: items_count === 1,\n            // @property {Boolean} isZipCodeRequire\n            isZipCodeRequire: is_zipcode_require,\n            // @property {Boolean} showEstimate Shows or not the estimation form\n            showEstimate: show_estimation_form,\n            // @property {Boolean} showHandlingCost\n            showHandlingCost: !!summary.handlingcost,\n            // @property {Boolean} showGiftCertificates\n            showGiftCertificates: !!summary.giftcertapplied,\n            // @property {Boolean} showPromocodeForm\n            showPromocodeForm:\n                Configuration.get('promocodes.allowMultiples', true) || !promocodes_applied.length,\n            // @property {Array} giftCertificates\n            giftCertificates: gift_certificates,\n            // @property {Boolean} showDiscountTotal\n            showDiscountTotal: !!summary.discounttotal,\n            // @property {String} defaultCountry\n            defaultCountry: default_country,\n            // @property {Boolean} isDefaultCountryUS\n            isDefaultCountryUS: default_country === 'US',\n            // @property {Array} countries\n            countries: countries_list,\n            // @property {Boolean} singleCountry\n            singleCountry: is_single_country,\n            // @property {String} singleCountryCode\n            singleCountryCode: is_single_country ? countries_list[0].code : '',\n            // @property {String} shipToText\n            shipToText: shipping_zip_code || selected_country.name,\n            // @property {String} singleCountryName\n            singleCountryName: is_single_country ? countries_list[0].name : '',\n            // @property {String} shippingZipCode\n            shippingZipCode: shipping_zip_code || '',\n            // @property {Boolean} showPaypalButton\n            showPaypalButton:\n                Configuration.get('siteSettings.checkout.paypalexpress.available', 'F') === 'T',\n            // @property {String} paypalButtonImageUrl\n            paypalButtonImageUrl: Configuration.get(\n                'paypalButtonImageUrl',\n                'https://www.paypalobjects.com/webstatic/en_US/i/buttons/checkout-logo-large.png'\n            ),\n            // @property {Boolean} showProceedButton\n            showProceedButton: Configuration.get('siteSettings.sitetype') === 'STANDARD',\n            // @property {String} urlLogin\n            urlLogin: this.getUrlLogin(),\n            // @property {Boolean} isPriceEnabled\n            isPriceEnabled: !ProfileModel.getInstance().hidePrices(),\n            // @property {Boolean} showPickupInStoreLabel\n            showPickupInStoreLabel: this.model.getPickupInStoreLines().length > 0,\n            // @property {Boolean} areAllItemsPickupable\n            areAllItemsPickupable:\n                this.model.getPickupInStoreLines().length === this.model.get('lines').length,\n            // @property {String} summaryLabel\n            taxLabel: Configuration.get('summaryTaxLabel')\n                ? Configuration.get('summaryTaxLabel')\n                : 'Tax',\n            // @property {Boolean} hasShippingAddrress\n            hasShippingAddrress: is_estimated_shipping_valid,\n\t\t\tshowLoginPage: ((digitalItems.length > 0) && (profileModel.get('firstname') === 'Guest') && (profileModel.get('lastname') === 'Shopper'))\n        };\n        // @class Cart.Summary.View\n    }\n});\n\nexport = existingView;\n\n"]}