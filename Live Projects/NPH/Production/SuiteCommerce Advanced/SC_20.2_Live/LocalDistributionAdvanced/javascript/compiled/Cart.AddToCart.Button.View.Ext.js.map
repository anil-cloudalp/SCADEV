{"version":3,"sources":["Cart.AddToCart.Button.View.Ext.ts"],"names":[],"mappings":"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","file":"Cart.AddToCart.Button.View.Ext.js","sourcesContent":["/// <amd-module name=\"Cart.AddToCart.Button.View.Ext\"/>\n\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { Configuration } from '../../../Advanced/SCA/JavaScript/Configuration';\n\nimport existingView = require('../../../Commons/Cart/JavaScript/Cart.AddToCart.Button.View');\n\nimport LiveOrderLineModel = require('../../../Commons/LiveOrder/JavaScript/LiveOrder.Line.Model');\nimport CartConfirmationHelpers = require('../../../Commons/Cart/JavaScript/Cart.Confirmation.Helpers');\n\n_.extend(existingView.prototype, {\n\n\taddToCart: function addToCart(e) {\n        try {\n            setTimeout(function() {\n\n                for (var i = 0; i < document.getElementsByClassName(\"bx-pager-link\").length; i++) {\n\n                    var activeImgOptionURL = (<HTMLImageElement>document.getElementsByClassName(\"bx-pager-link\")[i].children[0]).currentSrc.split(\"?\")[0];\n                    var mainImg = document.getElementsByClassName(\"product-details-image-gallery-container\")[i+1].innerHTML;\n                    var mainImgSplit = mainImg.split(\" \");\n                    var mainImgSplitURL = mainImgSplit[1].split(\"?\");\n\n                    if(mainImgSplitURL[0] != (\"src=\\\"\" + activeImgOptionURL)){\n\n                        mainImgSplitURL[0] = \"src=\" + activeImgOptionURL;\n                        mainImgSplit[1] = mainImgSplitURL.join(\"?\");\n                        var newImgSrc = mainImgSplit.join(\" \");\n                        document.getElementsByClassName(\"product-details-image-gallery-container\")[i+1].innerHTML = newImgSrc;\n\n                    }\n                }\n            }, 3000);\n        } catch (e) {\n            console.warn('The Zoom bug fix is throwing an error (Cart.AddToCart.Button.View): ' + JSON.stringify(e));\n        }\n        e.preventDefault();\n        const self = this;\n        let cart_promise;\n\t\t\n\t\tvar imprintItemId:any = '';\n\t\tvar crossItemId:any = '';\n\t\tvar holyItemId:any = '';\n\t\tvar imprintItemLines = [];\n\t\t\t\n\t\tif($('.sub-items').length > 0)\n\t\t\tvar isSubItem = true;\n\t\telse\n\t\t\tvar isSubItem = false;\n\n\t\tif(isSubItem){\n\t\t\t\n\t\t\t_.each($('[name=\"sub_item_qty\"]'),function(subItem){\n\t\t\t\t\n\t\t\t\tvar qtyEl = $(subItem);\n\t\t\t\t\n\t\t\t\tvar itemQty = $(subItem).val();\n\t\t\t\t\titemQty = parseInt(String(itemQty));\n\t\t\t\t\n\t\t\t\tif(itemQty > 0){\n\t\t\t\t\t\n\t\t\t\t\tvar itemId:any = $(subItem).attr('data-item-id');\n\t\t\t\t\t\n\t\t\t\t\tvar\tsubItemLine:any =  {\n\t\t\t\t\t\tquantity: itemQty,\n\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\tinternalid: itemId\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\timprintItemLines.push(subItemLine);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (\n            !this.model.areAttributesValid(['options', 'quantity'], self.getAddToCartValidators())\n        ) {\n            return;\n        }\n\t\t\n\t\tif(_.has(this,'attributes')){\n\t\t\t\n\t\t\tif(_.has(this.attributes,'data-root-component-id')){\n\t\t\t\t\n\t\t\t\tif(_.propertyOf(this.attributes)('data-root-component-id') == \"ProductDetails.Full.View\"){\n\t\t\t\t\t\n\t\t\t\t\tvar imprintItem = this.model.get('custcol_appf_imprint_item_details') || '';\n\t\t\t\t\tvar isCrossItem = this.model.get('custcol_appf_imprint_cross') || '';\n\t\t\t\t\tvar isHollyItem = this.model.get('custcol_appf_holy_bible') || '';\n\t\t\t\t\t\t\n\t\t\t\t\tif(imprintItem){\n\t\t\t\t\t\tif(imprintItem.indexOf('|') != -1){\n\t\t\t\t\t\t\t imprintItemId = parseInt(imprintItem.split('|')[0]);\n\t\t\t\t\t\t \n\t\t\t\t\t\t\tif(isCrossItem == \"T\")\n\t\t\t\t\t\t\t\t crossItemId = parseInt(imprintItem.split('|')[2]);\n\t\t\t\t\t\t\tif(isHollyItem == \"T\")\n\t\t\t\t\t\t\t\tholyItemId = parseInt(imprintItem.split('|')[4]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar imprintItemQty = this.model.get('quantity') || '';\n\t\t\t\n\t\tif(imprintItemId && imprintItemQty){\n\t\t\t\n\t\t\tvar\tothitem =  {\n\t\t\t\tquantity: imprintItemQty,\n\t\t\t\titem: {\n\t\t\t\t\tinternalid: imprintItemId\n\t\t\t\t}\n\t\t\t};\n\t\t\timprintItemLines.push(othitem);\n\t\t\tif(crossItemId){\n\t\t\t\t\n\t\t\t\timprintItemLines.push({\n\t\t\t\t\tquantity: imprintItemQty,\n\t\t\t\t\titem: {\n\t\t\t\t\t\tinternalid: crossItemId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(holyItemId){\n\t\t\t\timprintItemLines.push({\n\t\t\t\t\tquantity: imprintItemQty,\n\t\t\t\t\titem: {\n\t\t\t\t\t\tinternalid: holyItemId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n        if (!this.model.isNew() && this.model.get('source') === 'cart') {\n            cart_promise = this.cart.updateProduct(this.model);\n\t\t\t\n\t\t\t/*if(imprintItemLines.length > 0){\n\t\t\t\tthis.cart.addLines(imprintItemLines);\n\t\t\t}*/\n\t\t\t\t\t\n            cart_promise.done(function() {\n                self.options.application.getLayout().closeModal();\n            });\n        } else {\n\t\t\t\n\t\t\tconst line = LiveOrderLineModel.createFromProduct(this.model);\n\t\t\t\n\t\t\tif(!isSubItem){\n\t\t\t\timprintItemLines.push(line);\n\t\t\t}\n\t\t\tif(imprintItemLines.length)\n\t\t\t\tcart_promise = this.cart.addLines(imprintItemLines);\n\t\t\telse\n\t\t\t\treturn false;\n            \n\t\t\tif(isSubItem)\n\t\t\t\tCartConfirmationHelpers._goToCart(cart_promise);\n\t\t\telse\n\t\t\t\tCartConfirmationHelpers.showCartConfirmation(\n\t\t\t\t\tcart_promise,\n\t\t\t\t\tline,\n\t\t\t\t\tself.options.application\n\t\t\t\t);\n        }\n\n        cart_promise.fail(function(jqXhr) {\n            let error_details = null;\n            try {\n                if (jqXhr && jqXhr.responseText) {\n                    const response = JSON.parse(jqXhr.responseText);\n                    error_details = response.errorDetails;\n                }\n            } catch (error) {\n                console.error(error);\n            } finally {\n                if (error_details && error_details.status === 'LINE_ROLLBACK') {\n                    self.model.set('internalid', error_details.newLineId);\n                }\n            }\n        });\n\n        this.disableElementsOnPromise(cart_promise, e.target);\n        return false;\n    }\n});\n\nexport = existingView;\n\n"]}