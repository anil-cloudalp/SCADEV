{"version":3,"sources":["ProductDetails.Base.View.Ext.ts"],"names":[],"mappings":"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","file":"ProductDetails.Base.View.Ext.js","sourcesContent":["/// <amd-module name=\"ProductDetails.Base.View.Ext\"/>\nimport * as _ from 'underscore';\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\nimport { AjaxRequestsKiller } from '../../../Commons/AjaxRequestsKiller/JavaScript/AjaxRequestsKiller';\nimport Backbone = require('../../../Commons/Utilities/JavaScript/backbone.custom');\n\nimport existingView = require('../../../Advanced/ProductDetails/JavaScript/ProductDetails.Base.View');\nimport ImprintOptionModel = require('./ProductDetails.ImprintOption.Model');\nimport MusicianResourceModel = require('../../../extensions/MusicianResource/JavaScript/MusicianResource.Model')\n\n\n_.extend(existingView.prototype, {\n\t\n\tinitialize:  _.wrap(existingView.prototype.initialize, function init(fn) {\n\t\tfn.apply(this, _.toArray(arguments).slice(1));\n\t\t\n\t\tthis.imprintOptionModel = new ImprintOptionModel();\n\t\tthis.musician = new MusicianResourceModel();\n\t}),\n\tproductDetails: function productDetails(api_query, options) {\n\t\tconst application = this.application;\n\t\tconst product = this.model;\n\t\tconst promise = jQuery.Deferred();\n\t\tconst item = product.get('item');\n\t\tconst self = this;\n\n\t\titem.fetch({\n\t\t\tdata: api_query,\n\t\t\tkillerId: AjaxRequestsKiller.getKillerId(),\n\t\t\tpageGeneratorPreload: true,\n\t\t\t// this will stop the ErrorManagement module to process this error\n\t\t\t// as we are taking care of it\n\t\t\tpreventDefault: true\n\t\t}).then(\n\t\t\t// Success function\n\t\t\tfunction(data, _result, jqXhr) {\n\t\t\t\tif (!item.isNew()) {\n\t\t\t\t\t// once the item is fully loaded we set its options\n\t\t\t\t\tproduct.setOptionsFromURL(options);\n\n\t\t\t\t\tproduct.set('source', options && options.source);\n\n\t\t\t\t\tproduct.set('internalid', options && options.internalid);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tapi_query.id &&\n\t\t\t\t\t\titem.get('urlcomponent') &&\n\t\t\t\t\t\tSC.ENVIRONMENT.jsEnvironment === 'server'\n\t\t\t\t\t) {\n\t\t\t\t\t\tnsglobal.statusCode = 301;\n\t\t\t\t\t\tnsglobal.location = product.generateURL();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.corrections && data.corrections.length > 0) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\titem.get('urlcomponent') &&\n\t\t\t\t\t\t\tSC.ENVIRONMENT.jsEnvironment === 'server'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tnsglobal.statusCode = 301;\n\t\t\t\t\t\t\tnsglobal.location = data.corrections[0].url + product.getQuery();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tBackbone.history.navigate(\n\t\t\t\t\t\t\t\t`#${data.corrections[0].url}${product.getQuery()}`,\n\t\t\t\t\t\t\t\t{ trigger: true }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tpromise.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.bindModel();\n\t\t\t\t\tvar itemId = self.model.get('item').get('internalid');\n\t\t\t\t\t\t\t\n\t\t\t\t\tself.imprintOptionModel.save({'itemId': itemId}).then(function(){\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.musician.save({\"iteminternalids\":[itemId]},{wait:true}).then(function(response){\n\t\t\t\t\t\t\tself.response = response\n\t\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\n\t\t\t\t} else if (jqXhr.status >= 500) {\n\t\t\t\t\tapplication.getLayout().internalError();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t} else if (jqXhr.responseJSON.errorCode !== 'ERR_USER_SESSION_TIMED_OUT') {\n\t\t\t\t\t// We just show the 404 page\n\t\t\t\t\tapplication.getLayout().notFound();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Error function\n\t\t\tfunction(jqXhr) {\n\t\t\t\tif (jqXhr.status >= 500) {\n\t\t\t\t\tapplication.getLayout().internalError();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t} else if (jqXhr.responseJSON.errorCode !== 'ERR_USER_SESSION_TIMED_OUT') {\n\t\t\t\t\t// We just show the 404 page\n\t\t\t\t\tapplication.getLayout().notFound();\n\t\t\t\t\tpromise.reject();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn promise;\n\t}\n});\n\nexport = existingView;\n\n"]}