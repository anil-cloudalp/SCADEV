{"version":3,"sources":["Register.View.ts"],"names":[],"mappings":"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","file":"Register.View.js","sourcesContent":["\n/// <amd-module name=\"Register.View\"/>\n/// <reference path=\"../../../Commons/Utilities/JavaScript/UnderscoreExtended.d.ts\"/>\nimport * as _ from 'underscore';\nimport * as register_tpl from 'register_custom.tpl';\n\nimport * as Utils from '../../../Commons/Utilities/JavaScript/Utils';\nimport * as jQuery from '../../../Commons/Core/JavaScript/jQuery';\n\nimport BackboneView = require('../../../Commons/BackboneExtras/JavaScript/Backbone.View');\n\nimport { Configuration } from '../../../Commons/Utilities/JavaScript/Configuration';\nimport GlobalViewsStatesView = require('../../../Commons/GlobalViews/JavaScript/GlobalViews.States.View');\nimport CountriesDropdownView = require('../../../Commons/GlobalViews/JavaScript/GlobalViews.CountriesDropdown.View');\nimport BackboneFormView = require('../../../Commons/Backbone.FormView/JavaScript/Backbone.FormView');\nimport RegisterModel = require('./Register.Model');\n\nimport { GlobalViewsMessageView }  from '../../../Commons/GlobalViews/JavaScript/GlobalViews.Message.View';\nimport HeaderSimplifiedView = require('../../../Advanced/Header/JavaScript/Header.Simplified.View');\nimport { FooterSimplifiedView } from '../../../Advanced/Footer/JavaScript/Footer.Simplified.View';\ndeclare const grecaptcha;\n\n// @module Register.View @extends Backbone.View\nconst RegisterView: any = BackboneView.extend({\n    template: register_tpl,\n\n    title: Utils.translate('Register'),\n\n    page_header: Utils.translate('Register'),\n\n    attributes: {\n        id: 'register-custom',\n        class: 'register-custom-page'\n    },\n\n    events: {\n        'change [data-action=\"selectcountry\"]': 'updateStates',\n        'blur [data-action=\"inputphone\"]': 'formatPhone',\n\t\t'submit form': 'submitForm'//'saveForm'\n    },\n\tbindings: {\n        '[name=\"firstname\"]': 'firstname',\n\t\t'[name=\"lastname\"]': 'lastname',\n        '[name=\"company\"]': 'company',\n        '[name=\"title\"]': 'title',\n        '[name=\"city\"]': 'city',\n        '[name=\"country\"]': 'country',\n        '[name=\"entityid\"]': 'entityid',\n        '[name=\"phone\"]': 'phone',\n\t\t'[name=\"email\"]': 'email',\n\t\t'[name=\"zip\"]': 'zip'\n    },\n    initialize: function() {\n\t\t\n\t\tthis.model = new RegisterModel();\n\t\tBackboneFormView.add(this);\n\t\t\n\t\tthis.model.on('save', _.bind(this.redirect, this));\n    },\n\tsubmitForm: function(e, model, props) {\n\t\te.preventDefault();\n\t\tvar  response = grecaptcha.getResponse();\n\t\tvar captchaError = false;\n\t\tif (response.length==0) \n\t\t{\n\t\t\tcaptchaError=true;\n\t\t\t  if ($('#form-recaptcha').parent().find('p[data-validation-error=\"block\"]').length == 0) {\n\t\t\t\t$('#form-recaptcha').parent().attr('data-validation-error', '');\n\t\t\t\t$('#form-recaptcha').parent().append('<p data-validation-error=\"block\">' + 'Please verify that you are not robot</p>');\n\t\t\t  }\n\t\t}\n\t\telse \n\t\t{\n\t\t  captchaError=false;\n\t\t  if ($('#form-recaptcha').parent().find('[data-validation-error=\"block\"]').length > 0) {\n\t\t\t$('#form-recaptcha').parent().removeAttr('data-validation-error');\n\t\t\t$('#form-recaptcha').parent().find('[data-validation-error=\"block\"]').remove();\n\t\t  }\n\t\t}\n\t\tif(!captchaError)\n\t\tthis.saveForm(e, model, props);\n\t},\n\tredirect: function(_context, response) {\n\t\t\n\t\tvar $alert_warn = this.$('[data-type=\"alert-placeholder\"]');\n\t\t\t\t\t\n\t\t$alert_warn.html('');\n\t\tvar $form = this.$('form.registration-fields');\n\t\tif(response){\n\t\t\t\n\t\t\tif(_.has(response,'error') && response.error == 'USER_EXISTS'){\n\t\t\t\t\n\t\t\t\t$alert_warn.html(\n\t\t\t\t\tnew GlobalViewsMessageView({\n\t\t\t\t\t\tmessage: 'User already exist.',\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tclosable: true\n\t\t\t\t\t}).render().$el\n\t\t\t\t);\n\t\t\t}\n\t\t\tif(_.has(response,'recordId')){\t\t\t\t\n\t\t\t\t$form[0].reset();\n\t\t\t\t$alert_warn.html(\n\t\t\t\t\tnew GlobalViewsMessageView({\n\t\t\t\t\t\tmessage: `Your request has been submitted successfully.<br/>Please contact support for login details.`,\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tclosable: true\n\t\t\t\t\t}).render().$el\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\t$alert_warn.html(\n\t\t\t\tnew GlobalViewsMessageView({\n\t\t\t\t\tmessage: 'Something went wrong,please try again later',\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tclosable: true\n\t\t\t\t}).render().$el\n\t\t\t);\n\t\t}\n\t},\n    formatPhone: function(e: any) {\n        const $target = jQuery(e.target);\n        $target.val((<any>_($target.val())).formatPhone());\n    },\n    updateStates: function(e: any) {\n        const statesView = this.getChildViewInstance('StatesView');\n        statesView.options.selectedCountry = this.$(e.currentTarget).val();\n        statesView.render();\n    },\n\n    // @property {Object} childViews\n    childViews: {\n        CountriesDropdown: function() {\n            return new CountriesDropdownView({\n                countries: Configuration.get('siteSettings.countries'),\n                selectedCountry: this.selected_country\n            });\n        },\n        StatesView: function() {\n            return new GlobalViewsStatesView({\n                countries: Configuration.get('siteSettings.countries'),\n                selectedCountry: this.selected_country,\n                selectedState: this.model.get('state')\n            });\n        }\n    },\n\tgetHeaderView: function() {\n        // We've got to disable passwordProtectedSite feature if customer registration is disabled.\n        if (\n            Configuration.getRegistrationType() !== 'disabled' &&\n            SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T'\n        ) {\n            return HeaderSimplifiedView;\n        }\n    },\n\n    getFooterView: function() {\n        // We've got to disable passwordProtectedSite feature if customer registration is disabled.\n        if (\n            Configuration.getRegistrationType() !== 'disabled' &&\n            SC.ENVIRONMENT.siteSettings.siteloginrequired === 'T'\n        ) {\n            return FooterSimplifiedView;\n        }\n    },\n\tloadRecaptcha: function() {\n\t\tvar url = 'https://www.google.com/recaptcha/api.js';\n\t\tthis.captchaPromise = jQuery.getScript(url);\n\t},\n\trender:function(){\n\t\tBackboneView.prototype.render.apply(this, arguments);\n\t\tthis.loadRecaptcha();\n\t},\n    getContext: function() {\n        return {\n            isNotCmsEdit: (window.parent.location.href.indexOf(\"cms\") == -1)? true:false\n\t\t\t, sitekey: SC.CONFIGURATION.recaptcha.sitekey || \"\"\n\t\t\n        };\n    }\n});\n\nexport = RegisterView;\n"]}